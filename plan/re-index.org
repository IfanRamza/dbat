| 1 | 1 | 1 | 1 | 1 |
| 1 | 2 | 3 | 4 | 5 |
| 1 | 2 | 3 | 4 | 5 |
| 1 | 1 | 1 | 1 | 1 |
| 1 | 1 | 1 | 1 | 1 |
| 0 | 0 | 0 | 0 | 0 |

| 1 | 0 | 0 | 0 | 0 |
| 1 | 2 | 3 | 4 | 5 |
| 1 | 2 | 3 | 4 | 5 |
| 1 | 0 | 0 | 0 | 0 |
| 1 | 0 | 0 | 0 | 0 |

serialize:

| 1 | 2 | 3 | 4 | 5 | 7 | 8 | 12 | 13 | 17 | 18 | 22 | 23 |

deserialize:

| 1 | 1 | 1 |  1 |  1 |
| 2 | 6 | 8 | 10 | 12 |
| 3 | 7 | 9 | 11 | 13 |
| 4 | 4 | 4 |  4 |  4 |
| 5 | 5 | 5 |  5 |  5 |

% Find the leading elements of each row.
vix=zeros(size(v));
for i=1:size(v,1)
  [~,ia,ib]=unique([0,v(i,:)]);
  vix(i,ia(2:end)-1)=true;
end

% Index to serialize v (matrix -> vector)
seIx=find(vix(:));

% Inverse mapping to seIx
deIx=vix;
deIx(vix~=0)=1:length(seIx);

% Expand to all elements that should be equal.
for k=1:length(seIx)
  [i,j]=find(vix.*deIx==k);
  deIx(i,v(i,:)==v(i,j))=k;
end

------------------------------------------

| 1 | 1 | 1 | 1 | 1 | 1 |
| 1 | 1 | 2 | 2 | 3 | 3 |
| 1 | 1 | 2 | 2 | 3 | 3 |
| 1 | 1 | 1 | 1 | 1 | 1 |
| 1 | 1 | 1 | 1 | 1 | 1 |

| 1 | 0 | 0 | 0 | 0 | 0 |
| 1 | 0 | 2 | 0 | 3 | 0 |
| 1 | 0 | 2 | 0 | 3 | 0 |
| 1 | 0 | 0 | 0 | 0 | 0 |
| 1 | 0 | 0 | 0 | 0 | 0 |

serialize:

| 1 | 2 | 3 | 4 | 5 | 12 | 13 | 22 | 23 |

deserialize:

| 1 | 1 | 1 | 1 | 1 | 1 |
| 2 | 2 | 6 | 6 | 8 | 8 |
| 3 | 3 | 7 | 7 | 9 | 9 |
| 4 | 4 | 4 | 4 | 4 | 4 |
| 5 | 5 | 5 | 5 | 5 | 5 |

